<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <!--link href="lib/fonts/micons/material-design-icons.css" rel="stylesheet"-->
    <link rel="stylesheet" type="text/css" href="lib/css/materialize.css">

    <!--script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script-->
    <script type="text/javascript" src="../../lib/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../lib/js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/loStorage.js"></script>
    <script type="text/javascript" src="lib/js/materialize.js"></script>
    <script type="text/javascript" src="lib/js/jquery.treetable.js"></script>
    <script type="text/javascript" src="lib/js/words.js"></script>

    <style type="text/css">
        @font-face {
            font-family: "Material Icons";
            font-style: normal;
            font-weight: 400;
            src: url("../../lib/fonts/material.woff2") format("woff2")
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: 400;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            /* -webkit-font-feature-settings: 'liga'; */
            -webkit-font-smoothing: antialiased
        }

        button[disabled="disabled"] {
            pointer-events: none;
        }

        a[disabled="disabled"] {
            pointer-events: none;
        }

        .btn-small {
            height: 28px;
            line-height: 28px;
            padding: 0 4px;
            font-size: 15px;
        }

        .btn-small i {
            font-size: 20px;
            line-height: inherit;
        }

        .btn-floating.btn-small {
            width: 28px;
            height: 28px;
            line-height: 28px;
            padding: 0;
        }

        .w100 {
            width: 100%;
        }


        .chip>img {
            margin: 2px 8px 2px -12px;
            height: 28px;
            width: 28px;
        }

        .chips .input {
            width: 30% !important;
        }

        .clear,
        .clear-10,
        .clear-15 {
            clear: both;
            height: 0;
            overflow: hidden;
            /* Pr√©caution pour IE 7 */
        }

        .clear-10 {
            margin-bottom: 10px
        }

        .clear-15 {
            margin-bottom: 15px
        }

        .clear10 {
            margin-bottom: 10px
        }

        .clear15 {
            margin-bottom: 15px
        }

        .h3em {
            height: 3em
        }

        .h2em {
            height: 2em
        }

        .h4em {
            height: 4em
        }

        #log-data {
            height: 45vh;
        }
        #tab-events-content, #log-data {
            /* box-sizing: border-box; */
            /* position: relative; */
            /* width: 100%; */
            /* height: 50vh; */
            border: 2px solid lightgray;
        }
        
        .event-span {
            border: 2px solid lightgray;
            height: 45vh;
        }
        #eventSpan {
            height: 44vh;
            
        }
        .card-header {
            font-size: 1.2rem;
            font-weight: 400;
        }

        table.treetable span.indenter {
            display: inline-block;
            margin: 0;
            padding: 0;
            text-align: right;
            /* Disable text selection of nodes (for better D&D UX) */
            user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -o-user-select: none;
            -webkit-user-select: none;
            /* Force content-box box model for indenter (Bootstrap compatibility) */
            -webkit-box-sizing: content-box;
            -moz-box-sizing: content-box;
            box-sizing: content-box;
            width: 24px;
        }

        #debugLevel.browser-default {
            height: 2.2em;
            font-size: 0.8rem;
        }

        textarea.input-output {
            font-family: 'DejaVu Sans Mono', monospace;
            font-size: 0.8rem;
        }

        table.treetable td,
        table.treetable th {
            padding: 4px 3px;
        }

        #script-output td {
            padding: 2px 2px;
        }
        td.ft {
            font-weight: 500;
            /* cursor: pointer; */
        }

        td.fd {
            font-size: 0.85rem;
        }

        td.ft.disabled {
            color: grey;
        }

        td.state-value {
            padding-right: 2em;
        }

        td a {
            color: inherit;
        }

        table.treetable span.indenter a {
            background-position: left center;
            background-repeat: no-repeat;
            display: inline-block;
            text-decoration: none;
            width: 24px;
        }


        table.treetable thead {
            background: #aaa url(data:image/png;base64,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) repeat-x top left;
            font-size: 1em;
        }

        table.treetable span.file {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAADoSURBVBgZBcExblNBGAbA2ceegTRBuIKOgiihSZNTcC5LUHAihNJR0kGKCDcYJY6D3/77MdOinTvzAgCw8ysThIvn/VojIyMjIyPP+bS1sUQIV2s95pBDDvmbP/mdkft83tpYguZq5Jh/OeaYh+yzy8hTHvNlaxNNczm+la9OTlar1UdA/+C2A4trRCnD3jS8BB1obq2Gk6GU6QbQAS4BUaYSQAf4bhhKKTFdAzrAOwAxEUAH+KEM01SY3gM6wBsEAQB0gJ+maZoC3gI6iPYaAIBJsiRmHU0AALOeFC3aK2cWAACUXe7+AwO0lc9eTHYTAAAAAElFTkSuQmCC);
        }

        table.treetable span.folder {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAGrSURBVDjLxZO7ihRBFIa/6u0ZW7GHBUV0UQQTZzd3QdhMQxOfwMRXEANBMNQX0MzAzFAwEzHwARbNFDdwEd31Mj3X7a6uOr9BtzNjYjKBJ6nicP7v3KqcJFaxhBVtZUAK8OHlld2st7Xl3DJPVONP+zEUV4HqL5UDYHr5xvuQAjgl/Qs7TzvOOVAjxjlC+ePSwe6DfbVegLVuT4r14eTr6zvA8xSAoBLzx6pvj4l+DZIezuVkG9fY2H7YRQIMZIBwycmzH1/s3F8AapfIPNF3kQk7+kw9PWBy+IZOdg5Ug3mkAATy/t0usovzGeCUWTjCz0B+Sj0ekfdvkZ3abBv+U4GaCtJ1iEm6ANQJ6fEzrG/engcKw/wXQvEKxSEKQxRGKE7Izt+DSiwBJMUSm71rguMYhQKrBygOIRStf4TiFFRBvbRGKiQLWP29yRSHKBTtfdBmHs0BUpgvtgF4yRFR+NUKi0XZcYjCeCG2smkzLAHkbRBmP0/Uk26O5YnUActBp1GsAI+S5nRJJJal5K1aAMrq0d6Tm9uI6zjyf75dAe6tx/SsWeD//o2/Ab6IH3/h25pOAAAAAElFTkSuQmCC);
        }

        table.treetable tr.collapsed span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.expanded span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr span.indenter a {
            outline: none;
            /* Expander shows outline after upgrading to 3.0 (#141) */
        }

        table.treetable tr.collapsed.selected span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.expanded.selected span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.accept {
            background-color: #a3bce4;
            color: #fff
        }

        #tree tbody {
            display: block;
            height: 45vh;
            overflow: auto;
        }

        .no-padding {
            padding: 0 0 0 0;
        }

        #tree thead,
        #tree tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        #tree thead {
            width: calc( 100% - 1em);
        }

        #tree {
            width: 100%;
        }

        table.treetable tr.collapsed.accept td span.indenter a {
            background-image: url(data:image/x-png;base64,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);
        }

        table.treetable tr.expanded.accept td span.indenter a {
            background-image: url(data:image/x-png;base64,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);
        }
    </style>

    <script type="text/javascript">
        //--------------------------------------------------------- COMMONS -----------------------------------------------------------------------
        /** 
         * Translate word
         * @param {type} word
         * @returns {String}
         */

        const testdebug = true;

        function debug(str) {
            if (testdebug)
                console.log(str);
        }
        debug('start load!');

        function _(word) {
            var text = translateWord(word, systemLang, systemDictionary);

            for (var i = 1; i < arguments.length; i++) {
                var pos = text.indexOf('%s');
                if (pos !== -1) {
                    text = text.replace('%s', arguments[i]);
                }
            }

            return text;
        }

        function ownKeys(obj) {
            return typeof obj === 'object' ? Object.keys(obj).filter(function (k) {
                return obj.hasOwnProperty(k);
            }) : [];
        }

        function ownKeysSorted(obj) {
            return ownKeys(obj).sort(function (a, b) {
                a = a.toLowerCase();
                b = b.toLowerCase();
                if (a == b) return 0;
                if (a > b) return 1;
                return -1;
            });
        }

        function getTimeString(time) {
            const tzoffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
            return (new Date(+time - tzoffset)).toISOString().slice(11, -1);
        }

        function cloneObject(obj) {
            return !!obj ? JSON.parse(JSON.stringify(obj)) : obj;
        }


        function newClick(sel, fun) {
            return offOn(sel, 'click', fun);
        }

        function addEvent(obj, type) {
            setTimeout(function (obj, type) {
                if (displayEvents.length > 4)
                    displayEvents.pop();
                var ne = $('#eventSpan').text(JSON.stringify(obj, null, 4)).html();
                displayEvents.unshift('<h6>' + type + ' event:' + new Date().toISOString() + '</h6><code>' + ne +
                    '</code>');
                $('#eventSpan').html(displayEvents.join('\n'));
            }, 2, obj, type);
        }

        var that = this,
            displayEvents = [],
            main = {
                firstConnect: true,
                objects: {},
                states: {},
                mstate: {},
                sstate: {},
                icons: {},
                svalues: {},
                currentId: null,
                currentHost: '',
                hosts: [],
                instances: [],
                that: this,
                changed: false,
                objectsLoaded: false,
                waitForRestart: false,
                connectCb: null,
                changed: false,
                socket: io.connect(),
                systemLang: 'en',
                adapterConfig: {},
                //            adapterConfigId: 'system.adapter.statemachine.0',
                adapterConfigId: 'statemachine.config',
                adapterConfigIds: [],

                //            socket: io.connect(location.protocol + '//' + location.host, {
                //                query: 'ws=true'
                //            }),
                saveConfig: function () {
                    if (checkMachines())
                        return;
                    main.adapterConfig = createConfig();
                    var cconf = main.objects[main.adapterConfigId];
                    cconf.native = main.adapterConfig;
                    //                main.objectChange(main.adapterConfigId, cconf);
                    main.socket.emit('setObject', main.adapterConfigId, cconf, function (err) {
                        if (err) {
                            showError(err);
                            //                        that.init(true);
                        }
                    });
                    main.oldconfig = createConfig(true);
                    main.changed = false;
                    showMessage('Saved Adapter config which restarted the machines!');
                },
                addSState: function addSState(obj, id) {
                    if (obj.type === 'state' && !id.startsWith('system.adapter.')) {
                        var n = obj.common.name;
                        //                    var i = {id: id, icon: main.icons['system.adapter.'+split]};
                        if (!main.mstate[n]) {
                            if (main.sstate[n]) {
                                main.sstate[id] = id;
                                main.mstate[n] = [id];
                                delete main.sstate[n];
                            } else
                                main.sstate[n] = id;
                        } else {
                            main.mstate[n].push(id);
                            main.sstate[id] = id;
                        }
                    }

                },
                objectChange: function (id, obj) {
                    if (obj) {
                        if (obj._rev && main.objects[id]) main.objects[id]._rev = obj._rev;
                        if (!main.objects[id] || JSON.stringify(main.objects[id]) != JSON.stringify(obj)) {
                            main.objects[id] = obj;
                        }
                    } else if (main.objects[id]) {
                        var oldObj = {
                            _id: id,
                            type: main.objects[id].type
                        };
                        delete main.objects[id];
                        if (id.match(/^system\.adapter\.[-\w]+\.[0-9]+$/)) { /// TODO
                            // Disable statemachine tab if no one script engine instance found
                            //                    var engines = main.fillEngines();
                            //                    $('#tabs').tabs('option', 'disabled', (engines && engines.length) ? [] : [4]);
                        }
                    }
                    addEvent(obj, `Object Change:${id}`);
                },
                stateChange: function (id, state) {
                    var os = cloneObject(main.states[id] || {});
                    var s = {
                        ostate: os,
                        nstate: cloneObject(state),
                    };
                    main.states[id] = state;
                    if (id.match(/^statemachine\.\d+\./)) {
                        for (var k of ownKeys(state))
                            if (k == 'ts' || s.ostate[k] == s.nstate[k]) {
                                delete s.nstate[k];
                                delete s.ostate[k];
                            }
//                        state.lc = 
                        s.nstate.lc = s.ostate.ts;
                        if (JSON.stringify(s.ostate) != JSON.stringify(s.nstate)) {
                            addEvent(s, `State change of ${id}`);
                            if (main.svalues[id])
                                $(`span[s-v="${id}"`).html(getValue(id, true));
                            /// TODO: check machine states to display them!
                        }
                    }
                    //id = id ? id.replace(/[\s'"]/g, '_') : ''; /// TODO - do not know what it does!
                    //if (!id || !id.match(/\.messagebox$/)) {
                    //}
                },
                getStates: function (callback) {
                    main.socket.emit('getStates', function (err, res) {
                        main.states = res;
                        if (typeof callback === 'function')
                            setTimeout(callback, 0);
                    });
                },
                getObjects: function (callback) {
                    main.socket.emit('getAllObjects', function (err, res) {
                        setTimeout(function () {
                            var obj;
                            main.objects = res;
                            for (var id in main.objects) {
                                if (id.slice(0, 7) === '_design') continue;

                                obj = res[id];
                                main.addSState(obj, id);
                                var an = obj._id.split('.')[2];
                                if (obj.common && obj.common.icon)
                                    main.icons[id] = '/adapter/' + id.split('.')[0] + obj.common.icon;
                                if (an && obj.type == "adapter") {
                                    main.icons[an] = '/adapter/' + an + '/' + obj.common.icon;
                                }
                                if (obj.type === 'instance') {
                                    main.instances.push(id);
                                    if (id.startsWith('system.adapter.statemachine.'))
                                        main.adapterConfigIds.push(id.slice(15));
                                }
                                //                        if (obj.type === 'channel' && id.match(/^script\.js\./)) main.groups.push(id);
                                if (obj.type === 'host') main.hosts.push(id);
                            }
                            main.objectsLoaded = true;
                            if (main.adapterConfigIds.length > 0)
                                main.adapterConfigId = 'system.adapter.' + main.adapterConfigIds[0];
                            if (typeof callback === 'function') callback();
                        }, 0);
                    });
                },

                onLog: function (message) {
                    //                    addEvent(message, ' On Log:');
                    if (!main.$parentOutput) main.$parentOutput = $('#script-output').parent().parent();

                    //{"message":"javascript.0 Stop script script.js.Script4","severity":"info","from":"javascript.0","ts":1455490697111,"_id":364}
                    if (message.message.indexOf('statemachine.') !== -1) {
                        const color = {
                            debug: "blue lighten-4",
                            error: "red lighten-4",
                            warning: "orange lighten-4",
                            info: "white"
                        }
                        var text = '<tr class="' + color[message.severity] + '"><td>' + getTimeString(new Date(
                                message.ts)) +
                            '</td><td>[' + message.severity + ']</td><td>' + message.message + '</td></tr>';
                        var h = main.$parentOutput.height();

                        var oldHeight = $('#script-output').height();
                        var scrollTop = main.$parentOutput.scrollTop();
                        var shiftToEnd = (scrollTop + h >= oldHeight - 5);

                        if (oldHeight > 2000) {
                            $('#script-output tr:first').remove();
                            var oldHeight1 = $('#script-output').height();
                            main.$parentOutput.scrollTop(scrollTop - (oldHeight - oldHeight1));

                            oldHeight = oldHeight1;
                        }

                        var scrollTop = main.$parentOutput.scrollTop();
                        var shiftToEnd = (scrollTop + h >= oldHeight - 5);

                        $('#script-output').append(text);

                        if (shiftToEnd) {
                            main.$parentOutput.scrollTop(oldHeight + 50);
                        }
                    }
                },

                /** 
                 * Read the settings for adapter
                 * @param {type} callback
                 */
                readInstanceConfig: function (callback) {
                    debug('main.readInstanceConfig');
                    main.systemConfig = main.objects['system.config'];
                    addEvent(main.systemConfig, "System Config");
                    if (main.systemConfig && main.systemConfig.common) {
                        main.systemLang = main.systemConfig.common.language;
                    } else {
                        main.systemLang = window.navigator.userLanguage || window.navigator.language;

                        //                    if (main.systemLang !== 'en' && main.systemLang !== 'de' && main.systemLang !== 'ru') {
                        //                        main.systemConfig.common.language = 'en';
                        //                        main.systemLang = 'en';
                        //                    }
                    }
                    main.adapterConfig = main.objects[main.adapterConfigId];
                    if (main.adapterConfig && main.adapterConfig.native)
                        main.adapterConfig = main.adapterConfig.native;
                    else
                        main.adapterConfig = null;

                    addEvent({
                        adapterConfig: main.adapterConfig,
                        language: systemLang,
                        states: ownKeys(main.states).length,
                        objects: ownKeys(main.objects).length,
                        hosts: ownKeys(main.hosts).length,
                        mstates: ownKeys(main.mstate).length,
                        sstates: ownKeys(main.sstate).length,
                    }, "Adapter Config")
                    if (typeof callback === 'function') {
                        callback();
                    }
                },
                init: function (callb) {
                    debug('main.init');
                    if (callb)
                        main.connectCb = callb;
                    main.socket.on('permissionError', function (err) {
                        showMessage(_('Has no permission to %s %s %s', err.operation, err.type, (
                            err.id ||
                            '')));
                    });
                    main.socket.on('objectChange', function (id, obj) {
                        setTimeout(main.objectChange, 0, id, obj);
                    });
                    main.socket.on('onUpdate', function (id, obj) {
                        setTimeout(main.stateChange, 0, id, obj);
                    });
                    main.socket.on('stateChange', function (id, obj) {
                        setTimeout(main.stateChange, 0, id, obj);
                    });
                    main.socket.on('connect', function () {
                        $('#connecting').hide();
                        if (main.firstConnect) {
                            main.firstConnect = false;

                            main.socket.emit('getUserPermissions', function (err, acl) {
                                main.acl = acl;
                                // Read system configuration
                                main.socket.emit('getObject', 'system.config', function (
                                    err, data) {
                                    main.systemConfig = data;
                                    if (!err && main.systemConfig && main.systemConfig
                                        .common) {
                                        systemLang = main.systemConfig.common.language;
                                    } else {
                                        systemLang = window.navigator.userLanguage ||
                                            window.navigator.language;

                                        if (systemLang !== 'en' && systemLang !==
                                            'de' &&
                                            systemLang !==
                                            'ru') {
                                            main.systemConfig.common.language =
                                                'en';
                                            systemLang = 'en';
                                        }
                                    }

                                    translateAll();

                                    main.getStates(function () {
                                        main.getObjects(function () {
                                            main.readInstanceConfig(
                                                function () {
                                                    if (main.connectCb)
                                                        main.connectCb();
                                                })
                                        })
                                    });
                                });
                            });
                        }
                        if (main.waitForRestart) {
                            location.reload();
                        }
                    });
                    main.socket.on('disconnect', function () {
                        $('#connecting').show();
                    });
                    main.socket.on('reconnect', function () {
                        $('#connecting').hide();
                        if (main.waitForRestart) {
                            location.reload();
                        }
                    });
                    main.socket.on('reauthenticate', function () {
                        location.reload();
                    });
                    main.socket.on('log', function (message) {
                        setTimeout(main.onLog, 1, message);
                    });

                }
            };

        var modalOpts = {
            dismissible: true, // Modal can be dismissed by clicking outside of the modal
            opacity: .5, // Opacity of modal background
            inDuration: 100, // Transition in duration
            outDuration: 100, // Transition out duration
            startingTop: '5%', // Starting top style attribute
            endingTop: '10%', // Ending top style attribute
            ready: function (modal) {
                var f = modal.find('.input-modal-field');
                if (f.first() && f.first()[0] && f.first()[0].nodeName == 'DIV')
                    f = f.find('.select-dropdown');
                f.focus();
            },

            complete: function modalComplete($m) {
                if (!$m) return;
                var fun = $m.data('callback');
                if (typeof fun == 'function')
                    fun($m.data('OK'));
            },
        };

        function createToast(string, icon, time) {
            var $toastContent = $((icon ? '<i class="medium material-icons">' + icon + '</i>&nbsp;&nbsp;' : '') +
                '<span><b>' + string + '</b></span>')
            //                .add($('<button class="btn-flat toast-action">OK</button>'))
            ;
            Materialize.toast($toastContent, time || icon == "error" ? 5000 : 3000, (icon == 'error' ?
                'red darken-4' :
                'blue darken-4') + ' rounded');
        }

        function showError(string) {
            createToast(string, 'error');
        }

        function showMessage(string) {
            createToast(string, 'announcement');
        }

        function enableDisable(sel, value) { //value = true = enabled
            if (Array.isArray(sel))
                return sel.forEach(function (id) {
                    enableDisable(id, value);
                })
            return makeSel(sel).toggleClass('disabled', !value);
        }

        function getValue(id, html) {
            var s = main.states[id];
            if (!s)
                return null;
            main.svalues[id] = true;
            var t = '' + s.val;
            var c = main.objects[id].common;
            if (c) {
                if (c.states && c.type == 'number')
                    c.states.split(';').forEach(function (i) {
                        var ss = i.split(':');
                        if (ss[0] == s.val)
                            t = ss[1];
                    });
                if (c.unit)
                    t += ' ' + c.unit;
            }
            if (html) {
                var newSpan = document.createElement('span');
                newSpan.innerText = t;
                var escaped = newSpan.innerHTML.replace(/"/g, '&quot;');
                if (t.length > 50)
                    t =
                    `<a href="#!" title="${escaped}">${newSpan.innerHTML.slice(0,30).replace(/"/g, '&quot;') + '...'}</a>`;
                else
                    t = escaped;

            }
            return t;
        }

        function showInputModal(o, fun) {
            if (typeof fun != 'function')
                fun = null;

            function ix(t, i) {
                return $('#input-modal-' + t + i);
            }
            var $t = $('#input-modal');
            $t.find('select').material_select('destroy');
            if (typeof o === 'string') {
                var a = o.split('|');
                o = {};
                o.title = a[0];
                o.text = a[1];
                o.button = a[2];
                o.fields = a.slice(3);
            }
            $('#input-modal-title').text(o.title || "Please enter");
            $('#input-modal-text').text(o.text || "");
            $('#input-modal-button').text(o.button || "OK");
            if (typeof o.fields === 'string')
                o.fields = [o.fields.split('|')]
            else if (!Array.isArray(o.fields) && typeof o.fields == 'object')
                o.fields = [
                    [o.fields.name, o.fields.icon, o.fields.value]
                ]
            else if (Array.isArray(o.fields) && !Array.isArray(o.fields[0]))
                o.fields = [o.fields];
            else if (!Array.isArray(o.fields))
                o.fields = [
                    ["Name", 'create', '']
                ];
            var html = '';
            for (var i = 0; i < 3 && i < o.fields.length; i++) {
                var ii = o.fields[i];
                var ip = '' + (i + 1);
                if (typeof ii[2] === 'string')
                    html +=
                    `<div class=" row"><div class="col s2"><i class="material-icons prefix right">${ii[1]}</i></div><div class="col s10">
                            <input type="text" placeholder=" " class="input-modal-field" id="input-modal-field${ip}" value="${ii[2]}"><label for="input-modal-field${ip}" class="active">${ii[0]}</label>
                                </div></div>`;
                else if (Array.isArray(ii[2])) {
                    var h =
                        `<div class=" row"><div class="col s2"><i class="material-icons prefix right">${ii[1]}</i></div><div class="input-field col s10">
                        <select id="input-modal-field${ip}" class="input-modal-field" ><option value="" disabled selected>Choose your option</option>`;
                    for (var ij of ii[2])
                        h += `<option value="${ij}">${ij}</option>`;
                    html += h + `</select><label>${ii[0]}</label></div></div>`;
                }
            }
            html = $('#input-modal-inputs').html(html);
            newClick('#input-modal-button', function (event) {
                $('#input-modal').data('OK', [$('#input-modal-field1').val(), $('#input-modal-field2').val(),
                    $('#input-modal-field3').val()
                ]);
            });


            html.find('select').material_select();
            $t.data('callback', o.callback || fun);
            $t.data('OK', null);
            $t.modal('open');
        }

        function confirmMessage(message, title, icon, buttons, callback) {
            function disEn(sel, val) {
                if (sel && sel[0]) {
                    switch (sel[0].nodeName) {
                        case 'BUTTON':
                            enableDisable(sel, val);
                            break;
                        case 'DIV':
                            if (val)
                                sel.show();
                            else
                                sel.hide();
                            break;
                        default:
                            break;
                    }
                }
            }

            function enableDisableChange(sel, text, icon) { //value = true = enabled
                sel = makeSel(sel);
                var ch = sel.children();
                var t = sel.data('mytype');
                if (!text)
                    text = '';
                if (t) {
                    sel.removeClass(t);
                    sel.data('mytype', null);
                }
                if (text) {
                    var m = text.match(/^\s*\(([\w\s*]+)\)\s*(.*)\s*$/);
                    if (m) {
                        sel.data('mytype', m[1])
                        sel.addClass(m[1]);
                        text = m[2];
                    }
                    disEn(sel, true);
                    if (ch.length > 1)
                        ch[1].innerHTML = text;
                }
                if (icon && ch.length > 0)
                    ch[0].innerHTML = icon;
                disEn(sel, text || icon);
            }

            if (typeof icon == 'function') {
                callback = icon;
                icon = undefined,
                    buttons = 2;
            } else if (typeof buttons == 'function') {
                callback = buttons;
                buttons = 2;
            }

            var t = $('#modalText').children();
            t[0].innerHTML = title || "Information";
            t[1].innerHTML = message || ' ';
            buttons = buttons || 1;
            if (typeof buttons === 'string')
                buttons = buttons.split(',');
            else if (!Array.isArray(buttons)) {
                buttons = buttons == 1 ? ['OK'] : ['OK', 'cancel'];
            }
            $('#modalIcon').text(icon || buttons.length > 1 ? 'help' : "info");
            enableDisableChange('#modalOk', buttons[0])
            if (buttons.length == 1)
                $('#modalExit').hide();
            else {
                enableDisableChange('#modalExit', buttons[1])
                $('#modalExit').show();
            }
            $('#dialog-modal').data('callback', callback);
            $('#dialog-modal').data('OK', false);
            $('#dialog-modal').modal('open');
        }



        function createConfig(comp) {
            if (!comp)
                return cloneObject(workTree);
            var all = {};
            all.debugLevel = parseInt(workTree.debugLevel);
            all.queueTime = parseInt(workTree.queueTime);
            all.queueAll = !!workTree.queueAll;
            all.folders = cloneObject(workTree.folders);
            return JSON.stringify(all);
        }

        function checkConfig() {
            if (oldconf)
                clearTimeout(oldconf);
            oldconf = setTimeout(function () {
                var now = createConfig(true);
                oldconf = null;
                if (!main.oldconfig)
                    main.oldconfig = now;
                main.changed = (main.oldconfig != now);
                enableDisable(['#saveButton', '#reloadButton'], main.changed);
            }, 100);

        }

        var curMachine, curState, curEdge, curVar, curFolder = '',
            $table, $debugLevel, curId, curPar, curChip, curScene, oldconf,
            curEvent, fromNode, idList = {},
            workTree, nameData, wi = [];

        const icons = {
                Folder: 'folder',
                FolderAd: 'create_new_folder',
                Machine: 'settings',
                MachineAdd: 'settings_applications',
                Link: 'insert_link',
                State: 'location_searching',
                StateAdd: 'my_location',
                Timer: 'timer',
                Timeout: 'timer_off',
                Event: 'flash_on',
                EventAdd: 'flash_auto',
                LinkAuto: 'star_border',
                Rename: 'edit',
                Delete: 'delete',
                Scene: 'list'
            },
            ticons = {
                machine: icons.Machine,
                state: icons.State,
                link: icons.Link,
                scene: icons.Scene,
                event: icons.Event,
                folder: icons.Folder,
                timer: icons.Timer
            },
            fields = {
                id: ' id',
                default: ' default',
                expanded: ' expanded',
                type: ' type',
                disabled: ' disabled',
                timeout: ' timeout',
                fire: ' fire',
                onFire: ' onfire',
                onEnter: ' onenter',
                onExit: ' onexit',
                function: ' function'
            },
            regStateName = /^[$_A-Za-z][\-$\w]{1,19}$/,
            regTimerName = /^(\d+w\s*)?(\d+d\s*)?(\d+h\s*)?(\d+m(?!s)\s*)?(\d+)?(m?s)?\s*$/,
            regMachineName = /^[$_A-Za-z][\-$\w]{2,19}$/,
            autoLink = "*";

        function setDebug(level) {
            $('#debugLevel').val(workTree.debugLevel = parseInt(level));
            checkConfig();
        }

        function pageInit(cb) {
            debug('pageInit');
            main.init(function () {
                //                options.locale = main.systemLang;
                //            alert('Selection length:' + $("#node-popUp").length + ', ' + $("#nodepopUp").length+ ', ' + $("#nodePopUp").length)
                workTree = cloneObject(main.adapterConfig);
                debug('main.init finished');
                if (cb && typeof cb === 'function')
                    cb();
            });

            window.onbeforeunload = function (evt) {
                if (main.changed) {
                    if (window.confirm(_('Script changes are not saved. Discard?'))) {
                        return null;
                    } else {
                        return _('Configuration not saved.');
                    }
                }
                return null;
            };

            $table = $("#tree");

            $('i[my-icon]').each(function (e) {
                $(this).text(icons[$(this).attr('my-icon')]);
            });

            $('#dialog-modal').modal(modalOpts);
            $('#input-modal').modal(modalOpts);
            newClick('#modalOk', function (event) {
                $('#dialog-modal').data('OK', true);
            });
            enableDisable('button.ok-cancel', false);
            $debugLevel = $('#debugLevel').unbind('change').change(function () {
                setDebug($(this).val());
            });
            $('#tab-events-content').show();
            offOn('#importButton', 'mousedown', function (evt) {
                evt.preventDefault();
                $('#fileJsonInput').click();
                return false;
            });
            offOn('#fileJsonInput', 'change', function (evt) {
                evt.preventDefault();
                if (evt.target.files.length <= 0)
                    return false;
                var reader = new FileReader();
                reader.onerror = function (evt) {
                    switch (evt.target.error.code) {
                        case evt.target.error.NOT_FOUND_ERR:
                            alert('File Not Found!');
                            break;
                        case evt.target.error.NOT_READABLE_ERR:
                            alert('File is not readable');
                            break;
                        case evt.target.error.ABORT_ERR:
                            alert('File read cancelled');
                            break; // noop
                        default:
                            alert('An error occurred reading this file.');
                    };
                };
                reader.onloadend = function (evt) {
                    if (evt.target.readyState == FileReader.DONE)
                        try {
                            var nc = JSON.parse(evt.target.result);
                            confirmMessage('Do you really want to import and loose any changes?',
                                'Import config', 'alert', ok => {
                                    if (ok) {
                                        addEvent(nc, 'Import File');
                                        workTree = nc;
                                        setTimeout(createFolderTree, 1);
                                        checkConfig();
                                    }
                                });
                        } catch (e) {
                            return showError('JSON file error! ' + e)
                        }
                };
                reader.readAsText(evt.target.files[0]);
                evt.target.value = "";
                // TODO: refresh table
                return false;
            });
            newClick('#exportButton', function (e) {
                e.preventDefault();
                var s = createConfig();
                if (checkMachines())
                    return;
                s.saved = (new Date()).toString();
                s = JSON.stringify(s, undefined, 2);
                var fileName = 'statemachine.json';
                if (window.navigator.msSaveOrOpenBlob) {
                    var blobObject = new Blob([s]);
                    window.navigator.msSaveOrOpenBlob(blobObject, fileName);
                } else {
                    var url = "data:text/javascript;charset=utf-8," + encodeURIComponent(s);
                    var link = document.createElement('a');
                    document.body.appendChild(link);
                    $(link).attr("download", fileName).attr("href", url).text('download');
                    link.click();
                    $('body').children('a').last().remove();
                }
                return false;
            });
            newClick('#saveButton', main.saveConfig);
            newClick('#reloadButton', function (event) {
                confirmMessage('Do you really want to reaload before saving any changes?',
                    'Reload config', 'alert',
                    function (ok) {
                        if (ok) {
                            main.changed = false;
                            window.location.reload();
                        }
                    });
            });
            $('select').material_select();
            offOn('input.mach-val', 'input', function (e) {
                var $t = $(this);
                var v = validateInput($t);
                var nid = $('#input-folder').val();
                if (this.id != 'input-folder')
                    nid = (nid ? nid + '.' : '') + $t.val();
                if (idList[nid])
                    $t.toggleClass('invalid', !(v = false));
                enableDisable($t.closest('div').find('a'), v);
                //                e.target.checkValidity();
                addEvent({
                    val: v,
                    v: $t.val(),
                    nid: nid
                }, 'input ' + $t[0].toString());
            });
            offOn('#input-name-folder', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-folder', curFolder != $(this).val());
            });
            offOn('#input-name-machine', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-machine', curMachine != $(this).val());
            });
            offOn('#input-name-event', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-event', curEvent != $(this).val());
            });
            offOn('#input-name-scene', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-scene', curScene != $(this).val());
            });
            $('div.input-table').hide();
            newClick('#folder-add', function (e) {
                var ok = $('#input-folder').val();
                if (ok) {
                    if (!regMachineName.test(ok))
                        showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                    else if (idList[ok])
                        showMessage('Name already used, please change!');
                    else {
                        addId(ok, null, icons.Folder, workTree.folders[ok] = {});
                        regenSelect(ok);
                    }
                }
            });
            newClick('#scene-add', function (e) {
                var ok = $('#input-scene').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][fields.type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var nid = curFolder ? curFolder + '.' + ok : ok;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(ok))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[nid])
                    showMessage('Name already used, please change!');
                else {
                    addId(ok, curFolder, icons.Scene, f[ok] = {});
                    regenSelect(nid);
                }
            });
            newClick('#event-add', function (e) {
                var ok = $('#input-event').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][fields.type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var nid = curFolder ? curFolder + '.' + ok : ok;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(ok))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[nid])
                    showMessage('Name already used, please change!');
                else {
                    addId(ok, curFolder, icons.Event, f[ok] = {});
                    regenSelect(nid);
                }
            });
            newClick('#machine-add', function (e) {
                var m = $('#input-machine').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][fields.type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var nid = curFolder ? curFolder + '.' + m : m;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(m))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[nid])
                    showMessage('Name already used, please change!');
                else {
                    var nm = f[m] = {};
                    addId(m, curFolder, icons.Machine, nm);
                    nm.Off = {};
                    addId('Off', nid, icons.State, nm.Off);
                    regenSelect(nid);
                }
            });
            newClick('a.input-remove',
                () => setTimeout(function () {
                    var id = curId;
                    var par = curPar;
                    s = idList[par];
                    if (s && s[fields.type] == 'machine') {
                        if (getStates(s).length < 2)
                            return showError(`cannot delete last state/timer of machine!`)
                    }

                    confirmMessage(`do you really want to delete '${id}'?`, 'Delete ' + id,
                        function (ok) {
                            if (ok) {
                                $table.treetable('removeNode', id);
                                var p = idList[par];
                                var name = id.split('.');
                                name = name[name.length - 1];
                                if (typeof p !== 'object') {
                                    p = workTree.folders[''];
                                    if (!p[name])
                                        p = workTree.folders;
                                }
                                delete p[name];
                                delete idList[id];
                                curId = null;
                                rebindTableCommands();
                            }
                        });
                }, 10));
            newClick('#input-add-timer', () => setTimeout(doCreateTimer, 20, '1m', curId));
            newClick(
                '#input-add-state', () => setTimeout(doCreateState, 20, 'new', curId));
            newClick(
                '.input-add-link', () => setTimeout(doCreateLink, 20));
            newClick($('div.table-interface').find(
                'a.input-execute'), () => showMessage('Execute for ' + curId));
            newClick(
                '#tab-events-content thead tr',
                function () {
                    selectRow($(this));
                });
        }

        function getNameData(write) {
            if (nameData && !write)
                return nameData;
            var ac = {};
            for (var as in main.sstate) {
                var id = main.sstate[as];
                if (!write || (main.objects[id] && main.objects[id].common.write))
                    ac[as] = getIcon(as);
            }
            for (var am of ownKeys(idList)) {
                var ty = ['machine', 'event', 'scene'].indexOf(idList[am][fields.type]);
                if (ty >= 0)
                    if (!ac[am])
                        ac[am] = getIcon(am);
            }
            if (!write) {
                nameData = ac;
                setTimeout(() => (namedata = null), 600000);
            }
            return ac;
        }

        function offOn($s, e, fun) {
            return makeSel($s).off(e).on(e, fun);
        }

        function parseActionChip(name) { // timedistance
            var c = {};
            if (typeof name === 'object') {
                c = cloneObject(name);
                name = c.tag;
            }
            c.tag = name = name ? name.trim() : '';
            var m; // evry xxx timer
            if (m = name.match(/^\s*(\d+m)?\s*(\d+s)?\s*(\d+(?:ms)?)?\s*$/)) {
                var a = [];
                var ts = 0;
                for (var i = 1; i < 4; ++i) {
                    var s = m[i];
                    if (s) {
                        while (s[s.length - 1] > '9')
                            s = s.slice(0, -1);
                        s = parseInt(s);
                        ts += s * [0, 60 * 1000, 1000, 1][i];
                        var ns = '' + s + ['', ' Minute', ' Second', ' MilliSecond'][i];
                        if (s)
                            a.push(ns + (s > 1 ? 's' : ''));
                    }
                }
                if (ts) {
                    c.text = 'Timer: ' + a.join(', ');
                    c.timems = ts;
                    c.name = name;
                    c.image = 'lib/img/hourglass.png';
                    return c;
                }
            } // exec command on system
            if (m = name.match(/^\s*\$\s*(.+)$/)) {
                c.cmd = m[1] ? m[1].trim() : undefined;
                c.text = 'Exec: ' + c.cmd;
                c.image = 'lib/img/exe.png';
                return c;
            } // eval javascript
            if (m = name.match(/^\s*(\(.+\))\s*$/)) {
                c.eval = m[1] ? m[1].trim() : undefined;
                c.text = 'Eval: ' + c.eval;
                c.image = 'lib/img/js.png';
                return c;
            }
            if (!(m = name.match( // id + verifier
                    // /^\s*([&!]{0,2})\s*([^\=\~]+)(\~\s*|\=\+\s*|\=\-\s*|\=\!\s*|\=.+|\=\?\s*|\s*)$/
                    /^\s*([^\!\&\=\~]+)(&\s*)?(!\s*)?(\~\s*|\=\+\s*|\=\-\s*|\=\!\s*|\=\?\s*|\=.+|\s*)$/
                )))
                return null;
            c.exec = m[4] ? m[4].trim() : '';
            c.ack = !!m[3];
            c.queue = !!m[2];
            //                c.ack = m[1] ? m[1] : undefined;
            c.idn = m[1] ? m[1].trim() : undefined;
            var id = main.sstate[c.idn];
            var ce = {
                '': 'Set from Input ',
                '~': "Toggle ",
                '=+': "Set On ",
                '=-': "Set Off ",
                '=!': 'Set Not Input ',
                '=?': 'Set Input ',
            };
            c.text = ce[c.exec] ? ce[c.exec] : c.exec + ' ';
            c.text += id ? '' : 'Undefined Id! '
            c.text += c.idn + (id && c.idn != id ? ' (' + id + ')' : '');
            if (c.queue)
                c.text += ' queued';
            if (c.ack)
                c.text += ' with ack';
            c.image = getIcon(c.idn);
            if (!c.image)
                c.image = 'lib/img/run.png';
            return c;
        }

        function parseEventChip(name) { // timedistance
            var c = {};
            if (typeof name === 'object') {
                c = cloneObject(name);
                name = c.tag;
            }
            c.tag = name = name ? name.trim() : '';
            var m; // evry xxx timer
            if (m = name.match(/^(\d+w)?\s*(\d+d)?\s*(\d+h)?\s*(\d+m)?\s*(\d+s?)?$/)) {
                var a = [];
                var ts = 0;
                for (var i = 1; i < 6; ++i) {
                    var s = m[i];
                    if (s) {
                        if (s[s.length - 1] > '9')
                            s = s.slice(0, -1);
                        s = parseInt(s);
                        ts += s * [0, 7 * 24 * 60 * 60, 24 * 60 * 60, 60 * 60, 60, 1][i];
                        var ns = '' + s + ['', ' Week', ' Day', ' Hour', ' Minute', ' Second'][i];
                        if (s)
                            a.push(ns + (s > 1 ? 's' : ''));
                    }
                }
                if (ts) {
                    c.timer = a.join(', ');
                    c.text = 'Every ' + c.timer;
                    c.times = ts;
                    c.name = name;
                    c.image = 'lib/img/timer-icon-timelapse.png';
                    return c;
                }
            } // time
            if (m = name.match(/^([\d\-\*\,\/]+)\s*:\s*([\d\-\*\,\/]+)\s*(?::\s*([\d\-\*\,\/]+))?$/)) {
                if (m[3] == undefined)
                    m[3] = 0;
                c.schedule = m[3] + ' ' + m[2] + ' ' + m[1] + ' * * *';
                c.text = 'At ' + c.schedule;
                c.image = 'lib/img/schedule_24h.png';
                c.name = name;
                return c;
            } // schedule
            if (m = name.match(
                    /^((?:[0-9]?\d|\*)(?:(?:[\/-][0-9]?\d)|(?:,[0-9]?\d)+)?\s*){5}((?:[0-9]?\d|\*)(?:(?:[\/-][0-9]?\d)|(?:,[0-9]?\d)+)?)?$/
                )) {
                c.schedule = (!m[2] ? '* ' : '') + name;
                c.text = 'Schedule ' + c.schedule;
                c.timer = name;
                c.image = 'lib/img/timer-icon-schedule.png';
                return c;
            };
            if (!(m = name.match( // id + verifier
                    /^([\/\!]?)(~?)([^\?]+)(\?\+(?=\s*$)|\?\-(?=\s*$)|\?\=|\?\!=|\?\>\=|\?\>|\?\<|\?\<\=|\?\?|\?\^|\?\$|\?\#|$)\s*(.*)$/
                )))
                return null;
            c.onchange = !!m[2];
            c.ack = m[1];
            c.idn = m[3].trim();
            c.image = getIcon(c.idn);
            if (!c.image)
                c.image = 'lib/img/flash.png';
            if (m[5])
                c.test = m[5].trim();
            c.check = m[4];
            c.text = c.onchange ? 'On change ' : '';
            c.text += c.ack == '/' ? 'No Ack ' : (c.ack == '!' ? 'Witch Ack ' : 'Any Ack ');
            c.text += c.idn;
            if (c.idn != main.sstate[c.idn])
                c.text += ' (' + main.sstate[c.idn] + ') ';
            c.text += c.check ? c.check.slice(1) + ' ' + c.test : '';
            return c;
        }

        function rebindActionData(inputArea, oid, field, parser, icon, text) {
            function parseChip(chip) {
                var fun = $ia.data('parsed-fun');
                return fun ? fun(chip) : null;
            }

            function makeChips(data, auto) {
                var opt = {
                    data: data,
                    placeholder: 'Enter an event',
                    secondaryPlaceholder: '+event',
                };
                if (auto)
                    opt.autocompleteOptions = {
                        data: auto,
                        limit: Infinity,
                        minLength: 1
                    }

                $ic.material_chip(opt);
                offOn($ic.find('input'), 'focusin', function () {
                    var v = $(this).val().trim();
                    var c = parseChip(v);
                    var o = $ia.data('parsed-chip');
                    var s = $ic.find('.chip.selected').text();
                    if (o && o.otag) {
                        o.tag = v;
                        c = parseChip(o);
                    }
                    $ia.data('parsed-chip', c);
                    if (c) {
                        addEvent(c, 'Focus...');
                        $it.text(c.text);
                    }
                });
                offOn($ic.find('input'), 'input', function () {
                    var v = $(this).val().trim();
                    var c = parseChip(v);
                    var o = $ia.data('parsed-chip');
                    var s = $ic.find('.chip.selected').text();
                    if (o && o.otag) {
                        o.tag = v;
                        c = parseChip(o);
                    }
                    $ia.data('parsed-chip', c);
                    if (c) {
                        addEvent(c, 'Chip...');
                        $it.text(c.text);
                    }
                });
                offOn($ic.find('div.chip'), 'mousedown', function () {
                    var v = $(this)[0].childNodes[1].nodeValue;
                    var o = $ia.data('parsed-chip');
                    if (o && o.tag === v)
                        setTimeout(function (t, o) {
                            $ia.data('parsed-chip', null);
                            addEvent(o, "deselect");
                            $ic.find('input').val('');
                            $ia.find('span.input-text').text('');
                        }, 10, this, o);

                });
            }

            function updateChips(object, gotoId) {
                var chips = $ic.material_chip('data').sort((a, b) => a.id - b.id);
                if (idList[object] && gotoId)
                    idList[object][gotoId] = chips.map(c => c.tag);
                makeChips(chips, getNameData());
                checkConfig();
            }


            var $ia = $(inputArea);
            $ia.data('d-id', oid).data('parsed-fun', parser);
            var $it = $ia.find('span.input-text');
            $ia.find('label.data-title').text(text);
            $ia.find('.data-icon').text(icon);
            var obj = oid && idList[oid];
            var chips = obj && obj[field];
            chips = chips || [];
            var id = 0;
            var data = chips.map(function (c) {
                var p = parseChip(c);
                if (p)
                    p.id = id++;
                else
                    p = {};
                return p;
            });
            var $ic = $ia.find('.chips');
            makeChips(data, getNameData(field != fields.fire));
            offOn($ic, 'chip.add', function (e, chip) {
                chip.id = id++;
                var c = parseChip(chip);
                for (var i of ownKeys(c))
                    chip[i] = c[i];
                $ia.data('parsed-chip', c);
                setTimeout(function () {
                    updateChips(oid, field);
                    $it.val('');
                    //                    $ia.find('div.chip.selected').removeClass('selected');
                    //                   $ic.find('div.chip').last().addClass('selected');
                    //                   selectChip($ia, chip);
                }, 10);
                addEvent(c, 'Chip.add');
                return true;
            });
            offOn($ic, 'chip.delete', function (e, chip) {
                addEvent(chip, 'Chip.Delete');
                addEvent($ic.material_chip('data'), 'All chips');
                $ia.data('parsed-chip', null);
                updateChips(oid, field);
            });
            offOn($ic, 'chip.select', function (e, chip) {
                if (chip.oid === undefined)
                    chip.oid = chip.id;
                if (chip.otag === undefined)
                    chip.otag = chip.tag
                selectChip($ia, chip);
            });
            offOn($ia.find('a.show-help'), 'click', function () {
                var $h = $(this).closest('.input-table');
                if (!$h.next('.input-table-help').length > 0)
                    $h = $h.next();
                $h = $h.next('.input-table-help');
                var s = !$h.data('shown');
                $h.data('shown', s);
                if (!s)
                    $h.hide();
                else
                    $h.show();
            })
            $ia.show();
            setDebug(workTree.debugLevel);
            offOn('a.input-rename', 'click', function () {
                var $t = $(this);
                var $h = $(this).closest('.input-table');
                var $i = $h.find('.input-field input');
                var nname = $i.val().trim();
                var aname = curId.split('.');
                var oname = aname.slice(-1)[0];
                var pname = aname.slice(0, -1).join('.');
                var nid = (pname ? pname + '.' : '') + nname;
                if (idList[nid])
                    return showError(`New id ${nid} already in use!`);
                confirmMessage(
                    `Do you really want to rename '${oname}' to '${nname}'?<br>You need to change the names manually in events or actions!`,
                    'Rename', 'help', 2,
                    function (ok) {
                        if (!ok)
                            return;
                        var p = pname ? idList[pname] : workTree.folders[""];
                        var no = p[nname] = p[oname];
                        delete p[oname];
                        idList[nid] = idList[curId];
                        delete idList[curId];
                        idList[nid][fields.id] = nid;
                        if (p[fields.type] === 'machine') {
                            if (p[fields.default] == oname)
                                p[fields.default] = nname;
                            for (var s of ownKeys(p))
                                if (!s.startsWith(' ')) {
                                    if (s.startsWith(autoLink)) {
                                        if (s.slice(1) == oname) {
                                            p[autoLink + nname] = p[s];
                                            delete p[s];
                                        }
                                    } else {
                                        var os = p[s];
                                        if (os[fields.type] == 'timer' && os[fields.timeout] ==
                                            oname)
                                            os[fields.timeout] = nname;
                                        for (var nk of ownKeys(os))
                                            if (!nk.startsWith(' '))
                                                if (nk == oname) {
                                                    os[nname] = os[nk];
                                                    delete os[nk];
                                                }

                                    }
                                }
                        }
                        regenSelect(nid);
                    });
            });
        }

        function selectChip($ia, chip) {
            var fun = $ia.data('parsed-fun');
            if (fun)
                chip = fun(chip);
            $ia.data('parsed-chip', chip);
            addEvent(chip, 'Chip.select');
            $ia.find('span.input-text').text(chip ? chip.text : '');
            if (chip)
                $ia.find('.chips input').val(chip.tag);
        }


        function getIcon(id) {
            if (main.icons[id])
                return main.icons[id];
            if (idList[id])
                return getIcon(['statemachine', 'flash.png', 'list.png'][
                    ['machine', 'event', 'scene'].indexOf(idList[id][fields.type])
                ]);
            if (main.sstate[id])
                id = main.sstate[id];
            if (main.icons[id])
                return main.icons[id];
            if (main.icons[id.split('.').slice(0, -1).join('.')])
                return main.icons[id.split('.').slice(0, -1).join('.')];
            if (id.endsWith('.png'))
                return 'lib/img/' + id;
            id = id.split('.')[0];
            if (main.icons[id])
                return main.icons[id];
            return null;
        }

        function validateInput($this) {
            if (typeof $this === 'string')
                $this = $($this);
            var nok = '';
            var val = $this.val();
            var c = $this.attr('minlength');
            if (c && val.length < c)
                nok = `input too short: you have ${val.length} out of minimal ${c}!`;
            else {
                c = $this.attr('maxlength');
                if (c && val.length > c)
                    nok = `input too long: you have ${val.length} out of maximal ${c}!`;
                else {
                    c = $this.attr('pattern');
                    if (c && !(new RegExp(c)).test(val))
                        nok = $this.attr('title') ? $this.attr('title') : 'Field must match pattern ' + c;
                }
            }
            $this.next().attr('data-error', nok === true ? '' : nok);
            $this.toggleClass('invalid', !!nok);
            return !nok;
        }

        function makeTr(id, parent, name, icon, obj, dis) {
            //            idList[id] = obj;
            var wic = 0;
            var disabled = (obj && obj[fields.disabled]) || dis;
            var type;
            var html =
                `<tr data-tt-id="${id}"${parent ? ' data-tt-parent-id="' + parent +'"' : ''}><td  class="ft ${disabled ? ' disabled' : ''}" width="${wi[wic++]}"><span><i class="material-icons tiny right">${icon}</i>&nbsp;${name}</span>&nbsp;&nbsp;</td>`;
            html +=
                `<td class="fd" width="${wi[wic++]}">${id}</td><td class="fd" width="${wi[wic++]}">`
            if ([icons.Machine, icons.Folder, icons.Event, icons.Scene].indexOf(icon) >= 0)
                //                        html += `<span><input type="checkbox" id="d-${id}" ${disabled ? '' : 'checked="checked"'}/><label for="d-${id}">Enabled</label></span>`;
                html +=
                `<div class="switch left"><label>Off<input class="is-disabled" type="checkbox" ${disabled ? '' : 'checked="checked"'}><span class="lever"></span>On</label></div>`;
            html += '&nbsp;';
            if ([icons.Machine, icons.Event, icons.Scene].indexOf(icon) >= 0)
                html +=
                `<span s-v="${'statemachine.0.'+id}" class="right">${getValue('statemachine.0.'+id,true)}</span>`;

            html += '</td></tr>\n';
            return html;
        }

        function createFolderTree(complete) {
            function traverseConfig(id, name, parent, obj, dis) {
                var items = ownKeysSorted(obj);
                var hasitems = items.length > 0 && !items[items.length - 1].startsWith(' ');
                var id = id || name;
                var timer = (items.indexOf(fields.timeout) >= 0) ? obj[fields.timeout] : '';
                var type = obj[fields.type];
                var icon = ticons[type];
                dis = dis || obj[fields.disabled];
                if (type === 'link' && name.startsWith(autoLink))
                    icon = icons.LinkAuto;
                if (name)
                    html += makeTr(id, parent, name, icon, obj, dis);
                if (id) {
                    idList[id] = obj;
                    obj[fields.id] = id;
                }
                for (var k of items)
                    if (!k.startsWith(' ')) {
                        nobj = obj[k];
                        if (typeof nobj === 'object')
                            traverseConfig(id ? id + '.' + k : k, k, id, nobj, dis);
                    }
            }

            var html = '';
            wi = [];
            $('#tree').find('thead tr th').each(function () {
                wi.push($(this).prop('width'));
            });
            idList = {};
            workTree.folders = copySorted(workTree.folders);
            for (var m of ownKeysSorted(workTree.folders))
                traverseConfig('', m, '', workTree.folders[m], false);
            $('#table-data').html(html);
            $table.treetable({
                expandable: true,
                onNodeExpand: function () {
                    if (idList[this.id] && ['machine', 'state', 'timer', 'folder'].indexOf(idList[
                            this.id][
                            fields.type
                        ]) >= 0)
                        idList[this.id][fields.expanded] = true;
                    checkConfig();
                },
                onNodeCollapse: function () {
                    if (idList[this.id])
                        delete idList[this.id][fields.expanded];
                    checkConfig();
                },
                indent: 24,
                stringCollapse: "Collapse",
                stringExpand: "Expand",
            }, true);

            function autoexpand(obj, id) {
                if (obj && obj[fields.expanded])
                    $table.treetable("expandNode", id);
                ownKeys(obj).forEach(function (k) {
                    autoexpand(obj[k], id ? id + '.' + k : k);
                });

            }
            autoexpand(workTree.folders, '');
            // Highlight selected row
            nameData = null;
            rebindTableCommands();
            var idt = {}
            $('[id]').each(function () {
                id = $(this).prop('id');
                idt[id] = (idt[id] || 0) + 1;
                if (idt[id] > 1)
                    console.log(id);
            });
        }

        function checkMachines() {
            var states = {},
                machines = {},
                ids = {},
                err = 0;

            function se(str) {
                showError(str);
                err++;
            }

            function setst(parent, state) {
                var name = parent ? parent + '.' + state : state;
                states[name] = states[name] ? states[name] + 1 : 1;
                return name;
            }

            function checkItem(parent, name, obj, pobj) {
                var typ = obj[fields.type];
                var par = parent ? parent : '';
                var nam2 = name.startsWith(autoLink) ? name.slice(1) : name;
                var oid = parent ? parent + '.' + name : name;
                var id = parent ? parent + '.' + nam2 : nam2;
                ids[oid] = obj;
                for (var i of ownKeys(obj))
                    if (!i.startsWith(' ')) {
                        var nobj = obj[i];
                        var ntyp = nobj[fields.type];
                        switch (ntyp) {
                            case 'state':
                                ids[id + '.' + i] = nobj;
                                machines[id] = machines[id] ? machines[id] + 1 : 1;
                                break;
                            case 'timer':
                                ids[id + '.' + i] = nobj;
                                machines[id] = machines[id] ? machines[id] + 1 : 1;
                                break;
                            case 'link':
                                if (i.startsWith(autoLink))
                                    setst(id, i.slice(1));
                                else
                                    setst(parent, i);
                        }
                    } else switch (i) {
                        case fields.timeout:
                            setst(parent, obj[fields.timeout]);
                            break;
                    }
                for (var i of ownKeys(obj))
                    if (!i.startsWith(' '))
                        checkItem(id, i, obj[i], obj);

                var t = ownKeys(obj).filter(x => !x.startsWith(' ') && !x.startsWith(autoLink));
                switch (typ) {
                    case 'machine':
                        if (obj[fields.default])
                            if (!obj[obj[fields.default]])
                                se(`Machine '${id}' has invalid default state '${obj[fields.default]}'`);
                        if (t.length < 2)
                            se(`Machine '${id}' has less than two states (${t})!`)
                        for (var s of t)
                            if (!states[id + '.' + s])
                                se(`State '${id+'.'+s}' has no links pointing to it!`)
                        break;
                    case 'state':
                        if (t.length < 1)
                            se(`State '${id}' needs at least one Link!`)
                        break;
                    case 'timer':
                        if (obj[fields.timeout])
                            if (!pobj[obj[fields.timeout]])
                                se(`Timer '${id}' has invalid timeout state '${obj[fields.default]}'`);
                        break;
                    case 'link':
                        if (name != nam2) {
                            if (!pobj[nam2])
                                se(`AutoLink '${id}' has invalid state '${nam2}'`);
                        } else {
                            var np = parent.split('.').slice(0, -1);
                            np.push(name);
                            np = np.join('.');
                            if (!ids[np])
                                se(`Link '${parent}' has invalid state '${name}'`);
                        }

                }
            }
            var folders = cloneObject(workTree.folders);
            for (var i of ownKeys(folders))
                checkItem("", i, folders[i], null);
            return err;
        }

        function isAnyChanged(str) {
            var o = (str = makeSel(str)).data('old');
            var ch = o != str.val().trim();
            enableDisable(str.closest('div.input-table').find('a.input-rename'), ch);
        }

        function makeSel($sel) {
            return typeof $sel === 'string' ? $($sel) : $sel;
        }

        function popStates($sel, m, val) {
            if (typeof m == 'string')
                m = idList[m];
            var html = '';
            if (!val)
                val = '';
            var ss = val.startsWith(autoLink) ? autoLink : '';
            if (val === '')
                html += `<option value="" selected>Not set</option>`;

            getStates(m).forEach(function (s) {
                html += `<option value="${ss+s}"${val == ss+s ? ' selected' : ''}>${ss+s}</option>`;
            });

            ($sel = makeSel($sel)).html(html).material_select();
            return $sel;
        }

        function selectId(id) {
            $table.treetable('reveal', id);
            selectRow($table.find('tr[data-tt-id="' + id + '"]'));
        }

        function regenSelect(id) {
            setTimeout(() => {
                createFolderTree();
                setTimeout(selectId, 100, id);
                checkConfig();
            }, 10);
        }


        function setOld($sel, val) {
            return makeSel($sel).val(val).data('old', val);
        }

        function selectRow($this) {
            $("#tab-events-content tr.selected").removeClass("selected blue lighten-4");
            curId = $this.data('ttId');
            if (!curId) {
                $('div.input-table').hide();
                return;
            }
            curPar = $this.data('ttParentId');
            var ido = idList[curId];
            var ty = ido && ido[fields.type];
            var ids = curId.split('.');
            var x = ids[0];
            $('#input-folder').val("");
            if (idList[x] && idList[x][fields.type] === 'folder') {
                $('#input-folder').val(curFolder = x);
                if (ids.length > 1)
                    x += '.' + ids[1];
            }
            var x2 = idList[x][fields.type];
            if (x2 === 'machine') {
                $('#input-machine').val(curMachine = getThisName(x));
                $('#input-event,#input-scene').val(curEvent = '');
                $('#input-name-machine').val(curMachine);
            } else if (x2 === 'event') {
                $('#input-machine,#input-scene').val(curMachine = '');
                $('#input-event').val(curEvent = getThisName(x));
                $('#input-name-event').val(curEvent);
            } else if (x2 === 'scene') {
                $('#input-machine,#input-event').val(curMachine = '');
                $('#input-scene').val(curScene = getThisName(x));
                $('#input-name-scene').val(curScene);
            }
            $('input.mach-val').removeClass('invalid');
            $('div.input-table').hide();
            $('#input-table-' + ty).show();
            var show = [];
            enableDisable('#input-rename-' + ty);
            offOn('input.input-function', 'input', function () {
                ido[fields.function] = $(this).val();
                checkConfig();
            });
            switch (ty) {
                case 'folder':
                    $('#input-name-folder').val(curFolder);
                    break;
                case 'link':
                    x = curPar;
                    $('#input-link-from').text('From ' + getThisName(curPar) + ' to:');
                    if (idList[curPar][fields.type] === 'machine')
                        x = curId;
                    $('#input-link-icon').text(x === curId ? icons.LinkAuto : icons.Link);
                    offOn(setOld(popStates('#input-tostate-link', getParId(x), getThisName(curId)), ido[
                        fields.timeout]), 'change', function () {
                        var n = curId.split('.').slice(-1)[0];
                        var p = idList[curPar];
                        var ns = $(this).val();
                        var nn = curPar + '.' + ns;
                        if (p[ns])
                            return showError(`State has already a link there!`)
                        if (p && p[n] && n != ns) {
                            p[ns] = p[n];
                            delete p[n];
                            p[ns][fields.id] = nn;
                            setTimeout(createFolderTree, 10);
                            setTimeout(selectId, 100, nn);
                            checkConfig();
                        }
                    });
                    offOn($('#input-function-link').val(ido[fields.function]), 'input', function () {
                        ido[fields.function] = $(this).val();
                        checkConfig();
                    });
                    rebindActionData('#input-event-data', curId, fields.fire, parseEventChip, icons.Event,
                        'Events for new state, current id:');
                    break;
                case 'state':
                    offOn($('#input-name-state').val(getThisName(curId)).data('old', getThisName(curId)),
                        'input',
                        function () {
                            validateInput($(this));
                            isAnyChanged('#input-name-state');
                        });
                    rebindActionData('#input-action-data', curId, fields.onEnter, parseActionChip, 'gps_fixed',
                        'Actions on Enter, current id:');
                    rebindActionData('#input-action-data1', curId, fields.onExit, parseActionChip, 'gps_off',
                        'Actions on Exit, current id:');
                    break;
                case 'timer':
                    offOn(setOld('#input-name-timer', getThisName(curId)), 'input', function () {
                        validateInput($(this));
                        isAnyChanged('#input-name-timer');
                    });
                    offOn(popStates('#input-timeout-state', curPar, ido[fields.timeout])
                        .data('old', ido[fields.timeout]), 'change',
                        function () {
                            ido[fields.timeout] = $(this).val();
                            checkConfig();
                        });
                    rebindActionData('#input-action-data', curId, fields.onEnter, parseActionChip, 'gps_fixed',
                        'Actions on Enter, current id:');
                    rebindActionData('#input-action-data1', curId, fields.onExit, parseActionChip, 'gps_off',
                        'Actions on Exit, current id:');
                    break;
                case 'scene':
                    rebindActionData('#input-action-data', curId, fields.onFire, parseActionChip, icons.Scene,
                        'Scene list, current id:');
                    break;
                case 'event':
                    offOn($('#input-function-event').val(ido[fields.function]), 'input', function () {
                        ido[fields.function] = $(this).val();
                        checkConfig();
                    });
                    rebindActionData('#input-event-data', curId, fields.fire, parseEventChip, icons.Event,
                        'Events which fire, current id:');
                    rebindActionData('#input-action-data', curId, fields.onFire, parseActionChip,
                        'directions_run',
                        'Action when fired, current id:');
                    break;
                case 'machine':
                    offOn(popStates('#input-machine-states', curId, ido[fields.default]), 'change', function () {
                        ido[fields.default] = $(this).val();
                        checkConfig();
                    });
                    break;
            }
            Materialize.updateTextFields();
            addEvent(ido, "Select Row");
            $this.addClass("selected blue lighten-4");
        }

        function rebindTableCommands() {
            offOn($('#table-data').find("tr"), 'mousedown', function () {
                if (curId == $(this).data('ttId'))
                    return;
                selectRow($(this));
            });

            offOn($('#table-data').find("input.is-disabled"), 'change', function (e) {
                var tr = $(this).closest('tr');
                var id = tr.data('ttId');
                var idl = idList[id];
                var en = this.checked;
                tr.find('td.ft').toggleClass('disabled', !en);
                if (en && idl)
                    delete idl[fields.disabled];
                else if (!en && idl)
                    idl[fields.disabled] = true;
                $('#table-data').find("td.ft").each(function (i, e) {
                    var cid = $(this).closest('tr').data('ttId');
                    if (cid && cid.startsWith(id + '.'))
                        $(this).toggleClass('disabled', !(en && (idList[cid] && !idList[cid][
                            fields
                            .disabled
                        ])));
                });
                addEvent(idList[id], 'enabled/disabled id ' + id);
                checkConfig();
                //                showMessage(id + (this.checked ? ' enabled' : ' disabled'));
            });
            checkConfig();
        }

        function getParId(id) {
            var s = id.split('.');
            return s.length > 0 ? s.slice(0, -1).join('.') : '';
        }

        function getThisName(id) {
            var s = id.split('.');
            return s.length > 0 ? s[s.length - 1] : '';
        }

        function getTreeNode(id) {
            return $table.treetable('node', id);
        }

        function addId(id, parent, icon, opt) {
            opt = opt || {};
            var idr, type, ids = parent ? parent + '.' + id : id;
            switch (icon) {
                case icons.Link:
                    type = 'link';
                    break;
                case icons.LinkAuto:
                    type = 'link'
                    break;
                case icons.Folder:
                    type = 'folder';
                    break;
                case icons.Machine:
                    type = 'machine';
                    break;
                case icons.Event:
                    type = 'event';
                    break;
                case icons.Scene:
                    type = 'scene';
                    break;
                case icons.State:
                    type = 'state';
                    break;
                case icons.Timer:
                    type = 'timer';
                    break;
            }
            if (type && !opt[type])
                opt[fields.type] = type;

            if (icon == icons.Folder)
                idr = workTree.folders;
            else
                idr = parent ? idList[parent] : workTree.folders[''];
            if (!idr || idList[ids])
                return showError(`cannot add id type '${icon}' '${id}' to parent '${parent}'!`);
            else {
                idList[ids] = opt;
                opt[fields.id] = ids;
            }
            var html = makeTr(ids, parent, id, icon, opt);
            $table.treetable('loadBranch', (parent ? getTreeNode(parent) : null), html);
            if (parent)
                $table.treetable('sortBranch', getTreeNode(parent), function (a, b) {
                    if (a.id > b.id) return 1;
                    if (a.id < b.id) return -1;
                    return 0;
                });
            $table.treetable('reveal', ids)
            rebindTableCommands();
        }

        function copySorted(obj) {
            if (!obj)
                return obj;
            if (typeof obj !== 'object' || Array.isArray(obj))
                return cloneObject(obj);
            var n = {};
            for (var k of ownKeysSorted(obj)) {
                n[k] = copySorted(obj[k]);
            }
            return n;
        }

        function doCreateState(txt, folder) {
            var fs = folder ? folder + '.' : '';
            showInputModal({
                title: 'Create State',
                text: '',
                button: 'Create',
                fields: [
                    ['State Name', icons.State, txt]
                ],
                callback: function (ok) {
                    if (ok && (ok = ok[0].trim())) {
                        if (!regStateName.test(ok))
                            showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                        else if (idList[fs + ok])
                            showMessage('Name already used, please change!');
                        else {
                            addId(ok, folder, icons.State, idList[curId][ok] = {});
                            return regenSelect(folder + '.' + ok);
                        }
                        setTimeout(doCreateState, 30, txt, folder);
                    }
                }
            });
        }

        function getStates(m) {
            if (typeof m === 'string')
                m = idList[m];
            return m && ownKeysSorted(m).filter(s => !s.startsWith(' ') && !s.startsWith(autoLink))
        }

        function doCreateLink() {
            var s = idList[curId][fields.type];
            var icon = icons.LinkAuto;
            var m = curId;
            var t = 'Autolink';
            if (s !== 'machine') {
                m = getParId(curId);
                icon = icons.Link;
                t = 'Link';
            }
            var xs = getStates(m);
            if (!xs)
                return showError(`Cold not create ${t} for '${curId}'`);
            if (icon == icons.LinkAuto)
                xs = xs.map(x => autoLink + x);
            showInputModal({
                title: 'Create ' + t,
                text: '',
                button: 'Create',
                fields: [
                    [t + ' from ' + curId, icon, xs]
                ],
                callback: function (ok) {
                    if (ok) {
                        var t = ok[0];
                        if (t && t.startsWith(autoLink))
                            t = t.slice(1);
                        if (!idList[m + '.' + t])
                            showMessage('You need to select an existing state!');
                        else {
                            addId(ok[0], curId, icon, idList[curId][ok[0]] = {});
                            return regenSelect(curId + '.' + ok[0]);
                        }
                        setTimeout(doCreateLink, 50);
                    }
                }
            });
        }

        function doCreateTimer(txt, folder) {
            var fs = folder ? folder + '.' : '';
            var m = idList[folder];
            var xs = m && getStates(m);
            if (!xs)
                return showError(`Cold not create timer for machine '${folder}'`);
            showInputModal({
                title: 'Create Timer',
                text: '',
                button: 'Create',
                fields: [
                    ['Timeout time', icons.Timer, txt],
                    ['Timeout state', icons.Timeout, xs]
                ],
                callback: function (ok) {
                    if (ok) {
                        var t = ok[0].trim();
                        if (!regTimerName.test(t))
                            showMessage('invalid timer: (1+w)(1+d)(1+h)(1+m)(1+((m)s))');
                        else if (idList[fs + t])
                            showMessage('Name already used, please change!');
                        else if (!idList[fs + ok[1]])
                            showMessage('You need to select an existing tieout state!');
                        else {
                            addId(t, folder, icons.Timer, m[t] = {});
                            //                            addId(ok[1], folder + '.' + t, icons.Timeout);
                            idList[folder + '.' + t][fields.timeout] = ok[1];
                            return regen(folder + '.' + t);
                        }
                        setTimeout(doCreateTimer, 30, t, folder);
                    }
                }
            });
        }

        $(function () {
            debug('first in $()');
            pageInit(function () { // this is called when initialization happened and all objects are loaded!
                createFolderTree(true);
                //                createIdTree();
                if (main.adapterConfigIds.length > 1) {
                    var ah = '';
                    for (var ai of main.adapterConfigIds)
                        ah +=
                        ` <option value="${ai}" ${ah == '' ? ' selected' : ''}>${ai}</option>`;
                    $('#adapter-instances').html(ah).material_select().change(function () {
                        var i = $(this).val();
                    });
                } else $('.instance-config').hide();
                offOn($('#queue-all'), 'change', function () {
                    workTree.queueAll = this.checked;
                    checkConfig();
                }).prop('checked', !!workTree.queueAll);
                offOn($('#input-queue'), 'input', function () {
                    var n = $(this).val();
                    var ok = parseInt(n) >= 10 && parseInt(n) < 1000;
                    validateInput($(this));
                    if (ok) {
                        workTree.queueTime = parseInt(n);
                        checkConfig();
                    }
                }).val('' + (workTree.queueTime || 10));
                debug('last in $()');
            });
        });
    </script>
</head>

<body>
    <div id="stateMachine">
        <div class="row">
            <div class="col s2 m2 l1">
                <div class="valign-wrapper right">
                    <img src="/adapter/statemachine/statemachine0.png" style="width: 2.5em; height: 2.5em" onclick="window.location.reload();">
                </div>
            </div>
            <div class="col s4 m4 l2">
                <h5>Statemachine Setup</h5>
            </div>
            <div class="col s2 m2 l1">
                <label class=" instance-config">Statemachine Instance to configure</label>
            </div>
            <div class="col s4 m4 l2">
                <select id="adapter-instances" class="instance-config">
                </select>
            </div>
            <div class="col s6 m6 l2">
                <h6>Control &amp; Options</h6>
            </div>
            <div class="col s3 m3 l2">
                <div class="switch left">
                    <label>Queue All Actions: Off
                        <input id="queue-all" type="checkbox">
                        <span class="lever"></span>On</label>
                </div>
            </div>
            <div class="col s2 m2 l1">
                <label for="input-queue" class="active">Queue Time in ms</label>
            </div>
            <div class="col s1 m1 l1">
                <input type="text" id="input-queue" minlength="2" maxlength="3" pattern="^\d+$" title="2 to 5 digit number">
            </div>
        </div>
        <div class="row">
            <div id="tab-events-content" class="col s12 m12 l6">
                <table id="tree" class="highlight bordered">
                    <thead>
                        <tr>
                            <th class="center" width="33%">Type</th>
                            <th class="center" width="33%">Id</th>
                            <th class="center" width="33%">Status</th>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="table-data" class='scrollable'>
                    </tbody>
                </table>
            </div>
            <div class="col s12 m12 l6 table-interface">
                <div class="row">
                    <div class="col s1">
                        <div class="right valign-wrapper">
                            <label>Debug</label>&nbsp;
                        </div>
                    </div>
                    <div class="col s3">
                        <select id="debugLevel" class="browser-default">
                            <option value="" disabled selected>Choose your option</option>
                            <option value="0">Debug off</option>
                            <option value="1">Debug only errors &amp; warnings</option>
                            <option value="2">Debug state changes</option>
                            <option value="3">Debug all events</option>
                        </select>
                    </div>
                    <div class="col s2">
                        <button id="exportButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">file_upload</i>
                            <span>Export</span>
                    </div>
                    <div class="col s2">
                        <button id="importButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">file_download</i>
                            <span>Import</span>
                            <input type="file" id="fileJsonInput" name="fileInput" />
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="saveButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">save</i>
                            <span>Save</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="reloadButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">loop</i>
                            <span>Reload</span>
                        </button>
                    </div>
                </div>
                <div class="divider clear10"></div>
                <div class="row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Folder"></i>
                        <label for="input-folder" class="active">Folder</label>
                        <a id="folder-add" title="Add Folder" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-folder" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Machine"></i>
                        <label for="input-machine" class="active">Machine</label>
                        <a id="machine-add" title="Add Machine" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-machine" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Event"></i>
                        <label for="input-event" class="active">Event</label>
                        <a id="event-add" title="Add Event" class="btn-floating btn btn-small waves-effect waves-light teal right  disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-event" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon=" Scene"></i>
                        <label for="input-scene" class="active">Scene</label>
                        <a id="scene-add" title="Add Scene" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-scene" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                </div>
                <div class="divider clear15"></div>
                <div id="input-table-folder" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Folder"></i>
                        <input type="text" id="input-name-folder" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-folder" class="active">Folder Name</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <!--a id="input-add-machine" title="Add Machine" class="btn-floating btn waves-effect waves-light teal">
                                <i class="material-icons" my-icon="MachineAdd"></i>
                            </a>
                            <a id="input-add-event" title="Add Event" class="btn-floating btn waves-effect waves-light teal">
                                <i class="material-icons" my-icon="EventAdd"></i>
                            </a-->
                            <a id="input-rename-folder" title="Rename Folder" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                                <a title="Delete Folder" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                    <i class="material-icons" my-icon="Delete"></i>
                                </a>
                        </div>
                    </div>
                </div>
                <div id="input-table-scene" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon=" Scene"></i>
                        <input type="text" id="input-name-scene" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-scene" class="active">Scene Name</label>
                    </div>
                    <div class="col s3">
                        <div class='left'>
                            <a title="Run Scene" class="input-execute btn-floating btn btn-small waves-effect waves-light orange">
                                <i class="material-icons" my-icon="Event"></i>
                            </a>
                        </div>
                        <div class='right'>
                            <a id="input-rename-scene" title="Rename Scene" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Scene" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                    </div>
                    <div class="col s3">
                        <label for="input-value-scene" class="active">Current Value</label>
                        <p s-v="" id="input-value-scene"></p>
                    </div>
                </div>
                <div id="input-table-event" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Event"></i>
                        <input type="text" id="input-name-event" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-event" class="active">Event Name</label>
                    </div>
                    <div class="col s3">
                        <div class='left'>
                            <a title="Goto State" class="input-execute btn-floating btn btn-small waves-effect waves-light orange">
                                <i class="material-icons" my-icon="Event"></i>
                            </a>
                        </div>
                        <div class='right'>
                            <a id="input-rename-event" title="Rename Event" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Event" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                        <label for="input-function-event" class="active">Function</label>
                        <input type="text" id="input-function-event" class="input-function">
                    </div>
                    <div class="col s3">
                        <label for="input-value-event" class="active">Current Value</label>
                        <p s-v="" id="input-value-event"></p>
                    </div>
                </div>
                <div id="input-table-machine" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Machine"></i>
                        <input type="text" id="input-name-machine" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-machine" class="active">Machine Name</label>
                    </div>
                    <div class="input-field col s3">
                        <div class='right'>
                            <a id="input-add-state" title="Add State" class="btn-floating btn btn-small waves-effect waves-light teal">
                                <i class="material-icons" my-icon="StateAdd"></i>
                            </a>
                            <a id="input-add-timer" title="Add Timer" class="btn-floating btn btn-small waves-effect waves-light teal">
                                <i class="material-icons" my-icon="Timer"></i>
                            </a>
                            <a title="Add Autolink" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="LinkAuto"></i>
                            </a>
                            <a id="input-rename-machine" title="Rename Machine" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Machine" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="StateAdd"></i>
                        <select id="input-machine-states" class "select-input-states">
                            <option value="" selected>Undefined</option>
                        </select>
                        <label>Default State</label>
                    </div>
                    <div class="col s3">
                        <label for="input-value-machine" class="active">Current State</label>
                        <p s-v="" id="input-value-machine"></p>
                    </div>
                </div>
                <div id="input-table-state" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="State"></i>
                        <input type="text" id="input-name-state" minlength="2" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-state" class="active">State</label>
                    </div>
                    <div class="col s3">
                        <div class='left'>
                            <a title="Goto State" class="input-execute btn-floating btn btn-small waves-effect waves-light orange">
                                <i class="material-icons" my-icon="Event"></i>
                            </a>
                        </div>
                        <div class='right'>
                            <a title="Add Link" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="Link"></i>
                            </a>
                            <a title="Rename State" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete State" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div id="input-table-timer" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Timer"></i>
                        <input type="text" id="input-name-timer" minlength="2" maxlength="20" pattern="^(\d+w\s*)?(\d+d\s*)?(\d+h\s*)?(\d+m(?!s)\s*)?(\d+)?(m?s)?\s*$"
                            title="Start with number and then (w,d,h,m,s,ms)">
                        <label for="input-name-timer" class="active">State</label>
                    </div>
                    <div class="col s3">
                        <div class='left'>
                            <a title="Goto State" class="btn-floating btn btn-small waves-effect waves-light orange">
                                <i class="material-icons" my-icon="Event"></i>
                            </a>
                        </div>
                        <div class='right'>
                            <a title="Add Link" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="Link"></i>
                            </a>
                            <a title="Change Timer" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Timer" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Timeout"></i>
                        <select id="input-timeout-state" class "select-input-states">
                            <option value="" disabled selected>select timeout</option>
                        </select>
                        <label for="input-timeout-state">Timeout State</label>
                    </div>
                </div>
                <div id="input-table-link" class="input-table row">
                    <div id="input-link-state" class="input-field col s3">
                        <i id="input-link-icon" class="material-icons prefix" my-icon="Link"></i>
                        <select id="input-tostate-link" class "select-input-states">
                            <option value="" disabled selected>select timeout</option>
                        </select>
                        <label id="input-link-from">from</label>
                    </div>
                    <div class="col s3">
                        <div class='left'>
                            <a title="Goto State" class="input-execute btn-floating btn btn-small waves-effect waves-light orange">
                                <i class="material-icons" my-icon="Event"></i>
                            </a>
                        </div>
                        <div class='right'>
                            <!--a id="input-rename-link" title="Save Change" class="btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a-->
                            <a title="Delete State" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                        <label for="input-function-link" class="active">Function</label>
                        <input type="text" id="input-function-link">
                    </div>
                </div>
                <div id="input-event-data" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="Event"></i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons show-help" my-icon="help">help</i>
                        </a>
                        <label class='data-title'>Event list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-event-help" class="input-table input-table-help row">
                    <div class "col s12">
                        <ul class="collapsible popout" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header">
                                    <i class="material-icons">help</i>Help on Events!</div>
                                <div class="collapsible-body">
                                    <span>Lorem ipsum dolor sit amet.</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="input-action-data" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="directions_run">directions_run</i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons" my-icon="help">help</i>
                        </a>
                        <label class='data-title'>Action list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-action-data1" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="directions_run">directions_run</i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons" my-icon="help">help</i>
                        </a>
                        <label class='data-title'>Action list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-action-help" class="input-table input-table-help row">
                    <div class "col s12">
                        <ul class="collapsible popout" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header">
                                    <i class="material-icons">help</i>Help on Actions!</div>
                                <div class="collapsible-body">
                                    <span>Lorem ipsum dolor sit amet.</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s6 no-padding">
                <div id='log-data' style="overflow-x: auto; overflow-y: auto" comment="; width: calc(100% - 30px)">
                    <table style="width: 100%">
                        <thead>
                            <tr width="80px"></tr>
                            <tr width="50px"></tr>
                            <tr width="*"></tr>
                        </thead>
                        <tbody id="script-output"></tbody>
                    </table>
                </div>
            </div>
            <div class="col s6 event-span">
                <pre id="eventSpan" style="font-size: 0.8em"></pre>
            </div>
        </div>
    </div>
    <div id="dialog-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s2">
                    <i id="modalIcon" class="material-icons large" my-icon="Folder">check</i>
                </div>
                <div id="modalText" class="col s10">
                    <h4>Title</h4>
                    <p>text</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="modalOk" class="modal-action modal-close waves-effect waves-light btn" type="submit">
                <i class="material-icons left">check</i>
                <span>OK</span>
            </button>
            <button id="modalExit" class="modal-action modal-close waves-effect waves-light btn brown">
                <i class="material-icons left">close</i>
                <span>cancel</span>
            </button>
        </div>
    </div>
    <div id="id-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s12">
                    <table id="tree-id" class='highlight bordered responsive-table'>
                        <thead>
                            <tr>
                                <th class="center" width="30%">id</th>
                                <th class="center" width="20%">name</th>
                                <th class="center" width="10%">type</th>
                                <th class="center" width="10%">role</th>
                                <th class="center" width="20%">value</th>
                            </tr>
                        </thead>
                        <tbody id="table-id-data" class='scrollable' height="30vh">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="modalIdOk" class="modal-action modal-close waves-effect waves-light btn" type="submit">
                <i class="material-icons left">check</i>
                <span>OK</span>
            </button>
            <button id="modalIdExit" class="modal-action modal-close waves-effect waves-light btn brown">
                <i class="material-icons left">close</i>
                <span>cancel</span>
            </button>
        </div>
    </div>
    <div id="input-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="row">
                    <div class="row">
                        <h4>
                            <span id="input-modal-title">Title</span>
                        </h4>
                        <p>
                            <span id="input-modal-text">Text</span>
                        </p>
                    </div>
                    <div id="input-modal-inputs"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat" type="submit" id="input-modal-button">OK</a>
            <a href="#" class="modal-close waves-effect waves-green btn-flat " id="input-modal-cancel">Cancel</a>
        </div>
    </div>


</body>

</html>